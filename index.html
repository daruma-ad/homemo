<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>„Éõ„É°„É¢</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#f39c12">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #fff;
      padding: 20px;
      padding-bottom: 100px;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    /* „Éò„ÉÉ„ÉÄ„Éº */
    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .title {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
    }

    /* ÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ */
    .input-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .time-display {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 900;
      color: #f39c12;
      margin-bottom: 16px;
      text-shadow: 0 2px 10px rgba(243, 156, 18, 0.3);
    }

    .task-input-wrapper {
      position: relative;
      margin-bottom: 16px;
    }

    .task-input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      font-size: 1.1rem;
      font-family: 'Noto Sans JP', sans-serif;
      transition: all 0.3s;
    }

    .task-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .task-input:focus {
      outline: none;
      border-color: #f39c12;
      box-shadow: 0 0 20px rgba(243, 156, 18, 0.2);
    }

    /* „ÇØ„Ç§„ÉÉ„ÇØ„Çø„Çπ„ÇØ„Éú„Çø„É≥ */
    .quick-tasks {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .quick-task-btn {
      padding: 10px 14px;
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 0.85rem;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
      position: relative;
    }

    .quick-task-btn:hover {
      transform: translateY(-2px);
    }

    .quick-task-btn:active {
      transform: scale(0.95);
    }

    .quick-task-btn .emoji {
      font-size: 1.1rem;
    }

    .quick-task-btn .label {
      font-weight: 700;
    }

    /* Ëâ≤„Éó„É™„Çª„ÉÉ„Éà */
    .color-red {
      background: linear-gradient(145deg, #e74c3c, #c0392b);
    }

    .color-blue {
      background: linear-gradient(145deg, #3498db, #2980b9);
    }

    .color-green {
      background: linear-gradient(145deg, #2ecc71, #27ae60);
    }

    .color-purple {
      background: linear-gradient(145deg, #9b59b6, #8e44ad);
    }

    .color-orange {
      background: linear-gradient(145deg, #e67e22, #d35400);
    }

    .color-pink {
      background: linear-gradient(145deg, #fd79a8, #e84393);
    }

    .color-teal {
      background: linear-gradient(145deg, #00cec9, #00b894);
    }

    .color-yellow {
      background: linear-gradient(145deg, #fdcb6e, #f39c12);
    }

    /* ËøΩÂä†„Éú„Çø„É≥ */
    .add-task-btn {
      padding: 10px 14px;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.85rem;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .add-task-btn:hover {
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    /* ÂÆå‰∫Ü„Éú„Çø„É≥ */
    .complete-btn {
      width: 100%;
      padding: 18px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(145deg, #e74c3c, #c0392b);
      color: #fff;
      font-size: 1.3rem;
      font-weight: 900;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(231, 76, 60, 0.4);
      transition: all 0.2s;
    }

    .complete-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(231, 76, 60, 0.5);
    }

    .complete-btn:active {
      transform: scale(0.98);
    }

    .complete-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* „É°„ÉÉ„Çª„Éº„Ç∏ */
    .message-box {
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
    }

    .message {
      font-size: 1.1rem;
      font-weight: 700;
      line-height: 1.5;
      padding: 14px 20px;
      background: rgba(243, 156, 18, 0.2);
      border-radius: 14px;
      border-left: 4px solid #f39c12;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
      text-align: center;
    }

    .message.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* „Çø„Ç§„É†„É©„Ç§„É≥„Çª„ÇØ„Ç∑„Éß„É≥ */
    .timeline-section {
      margin-top: 10px;
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .timeline-title {
      font-size: 1rem;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.8);
    }

    .timeline-count {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.5);
    }

    /* „Çø„Ç§„É†„É©„Ç§„É≥„Ç¢„Ç§„ÉÜ„É† */
    .timeline {
      position: relative;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 24px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: rgba(255, 255, 255, 0.1);
    }

    .timeline-item {
      position: relative;
      padding-left: 60px;
      padding-bottom: 20px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .timeline-dot {
      position: absolute;
      left: 16px;
      top: 4px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(145deg, #f39c12, #e67e22);
      box-shadow: 0 2px 10px rgba(243, 156, 18, 0.4);
    }

    .timeline-time {
      font-size: 0.85rem;
      font-weight: 700;
      color: #f39c12;
      margin-bottom: 4px;
    }

    .timeline-task {
      font-size: 1rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 6px;
    }

    .timeline-praise {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      display: inline-block;
    }

    .timeline-empty {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.95rem;
    }

    /* Áµ±Ë®à */
    .stats {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 14px 16px;
      border-radius: 12px;
      text-align: center;
      flex: 1;
    }

    .stat-number {
      font-size: 1.6rem;
      font-weight: 900;
      color: #f39c12;
    }

    .stat-label {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 2px;
    }

    /* Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ */
    .settings-toggle {
      text-align: center;
      margin-bottom: 10px;
    }

    .settings-toggle button {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.85rem;
      cursor: pointer;
      padding: 8px 16px;
    }

    .settings-section {
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      display: none;
    }

    .settings-section.show {
      display: block;
    }

    .settings-section input {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .settings-section input:focus {
      outline: none;
      border-color: #f39c12;
    }

    .settings-section label {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.7);
    }

    /* „É¢„Éº„ÉÄ„É´ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      padding: 20px;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: linear-gradient(145deg, #1e2a4a, #162035);
      border-radius: 24px;
      padding: 24px;
      width: 100%;
      max-width: 360px;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.show .modal {
      transform: translateY(0);
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 24px;
      text-align: center;
    }

    .modal-field {
      margin-bottom: 20px;
    }

    .modal-field label {
      display: block;
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 10px;
    }

    .modal-field input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      font-size: 1rem;
      font-family: 'Noto Sans JP', sans-serif;
    }

    .modal-field input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .modal-field input:focus {
      outline: none;
      border-color: #f39c12;
    }

    /* ÁµµÊñáÂ≠ó„Éî„ÉÉ„Ç´„Éº */
    .emoji-picker {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
    }

    .emoji-option {
      aspect-ratio: 1;
      border: 2px solid transparent;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      font-size: 1.4rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .emoji-option:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .emoji-option.selected {
      border-color: #f39c12;
      background: rgba(243, 156, 18, 0.2);
    }

    /* Ëâ≤„Éî„ÉÉ„Ç´„Éº */
    .color-picker {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .color-option {
      aspect-ratio: 1;
      border: 3px solid transparent;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: #fff;
    }

    /* „É¢„Éº„ÉÄ„É´„Éú„Çø„É≥ */
    .modal-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .modal-btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.primary {
      background: linear-gradient(145deg, #f39c12, #e67e22);
      color: #fff;
    }

    .modal-btn.secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .modal-btn.danger {
      background: rgba(231, 76, 60, 0.8);
      color: #fff;
      flex: 0.5;
    }

    .modal-btn:hover {
      transform: translateY(-2px);
    }

    /* Á¥ôÂêπÈõ™ */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      animation: confetti-fall 1s ease-out forwards;
    }

    @keyframes confetti-fall {
      0% {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }

      100% {
        opacity: 0;
        transform: translateY(300px) rotate(720deg);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1 class="title">üéâ „Éõ„É°„É¢</h1>
      <p class="subtitle">„Çø„Çπ„ÇØ„ÇíË®òÈå≤„Åó„Å¶Ë§í„ÇÅ„Çâ„Çå„Çà„ÅÜÔºÅ</p>
    </div>

    <!-- ÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
    <div class="input-section">
      <div class="time-display" id="currentTime">12:30</div>

      <div class="task-input-wrapper">
        <input type="text" class="task-input" id="taskInput" placeholder="‰ªä„ÇÑ„Å£„Åü„Åì„Å®„ÇíÂÖ•Âäõ...">
      </div>

      <div class="quick-tasks" id="quickTasks">
        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
      </div>

      <button class="complete-btn" id="completeBtn">ÂÆå‰∫ÜÔºÅüí™</button>
    </div>

    <!-- „É°„ÉÉ„Çª„Éº„Ç∏ -->
    <div class="message-box">
      <p class="message" id="message"></p>
    </div>

    <!-- Áµ±Ë®à -->
    <div class="stats">
      <div class="stat-item">
        <div class="stat-number" id="todayCount">0</div>
        <div class="stat-label">‰ªäÊó•„ÅÆÈÅîÊàê</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="totalCount">0</div>
        <div class="stat-label">Á¥ØË®à</div>
      </div>
    </div>

    <!-- „Çø„Ç§„É†„É©„Ç§„É≥ -->
    <div class="timeline-section">
      <div class="timeline-header">
        <span class="timeline-title">üìÖ ‰ªäÊó•„ÅÆ„É≠„Ç∞</span>
        <span class="timeline-count" id="logCount">0‰ª∂</span>
      </div>
      <div class="timeline" id="timeline">
        <div class="timeline-empty">„Åæ„Å†„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>„Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Åó„Å¶Ë®òÈå≤„Åó„Çà„ÅÜÔºÅ</div>
      </div>
    </div>

    <!-- Ë®≠ÂÆö -->
    <div class="settings-toggle">
      <button id="settingsToggle">‚öôÔ∏è Ë®≠ÂÆö</button>
    </div>
    <div class="settings-section" id="settingsSection">
      <label for="apiKey">üîë Gemini API Key</label>
      <input type="password" id="apiKey" placeholder="AIza...">
    </div>
  </div>

  <!-- „Çø„Çπ„ÇØËøΩÂä†/Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
  <div class="modal-overlay" id="taskModal">
    <div class="modal">
      <h2 class="modal-title" id="modalTitle">„Çø„Çπ„ÇØ„ÇíËøΩÂä†</h2>

      <div class="modal-field">
        <label>„Çø„Çπ„ÇØÂêç</label>
        <input type="text" id="taskNameInput" placeholder="‰æãÔºöÁ≠ã„Éà„É¨„Åó„Åü">
      </div>

      <div class="modal-field">
        <label>„Ç¢„Ç§„Ç≥„É≥</label>
        <div class="emoji-picker" id="emojiPicker"></div>
      </div>

      <div class="modal-field">
        <label>Ëâ≤</label>
        <div class="color-picker" id="colorPicker"></div>
      </div>

      <div class="modal-buttons">
        <button class="modal-btn secondary" id="cancelBtn">„Ç≠„É£„É≥„Çª„É´</button>
        <button class="modal-btn danger" id="deleteBtn" style="display: none;">ÂâäÈô§</button>
        <button class="modal-btn primary" id="saveBtn">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>

  <script>
    // ÁµµÊñáÂ≠ó„É™„Çπ„Éà
    const EMOJIS = ['üí™', 'üìö', 'üíä', 'üíß', 'üèÉ', 'üßò', '‚úçÔ∏è', 'üéß', 'üåø', 'üßπ', 'ü•±', 'üçé',
      '‚òï', 'üéØ', 'üî•', '‚≠ê', 'üíé', 'üåô', 'üéµ', 'üíª', 'üìù', 'üé®', 'üö¥', 'üèãÔ∏è'];

    // Ëâ≤„É™„Çπ„Éà
    const COLORS = ['red', 'blue', 'green', 'purple', 'orange', 'pink', 'teal', 'yellow'];

    // „Éá„Éï„Ç©„É´„Éà„Çø„Çπ„ÇØ
    const DEFAULT_QUICK_TASKS = [
      { id: 'workout', emoji: 'üí™', label: 'Á≠ã„Éà„É¨', color: 'red' },
      { id: 'study', emoji: 'üìö', label: 'ÂãâÂº∑', color: 'blue' },
      { id: 'medicine', emoji: 'üíä', label: 'Ëñ¨', color: 'green' },
      { id: 'water', emoji: 'üíß', label: 'Ê∞¥', color: 'purple' },
      { id: 'stretch', emoji: 'üßò', label: '„Çπ„Éà„É¨„ÉÉ„ÉÅ', color: 'teal' },
    ];

    // Áä∂ÊÖã
    let quickTasks = [];
    let todayLogs = [];
    let editingTaskId = null;
    let selectedEmoji = 'üí™';
    let selectedColor = 'red';

    // DOMË¶ÅÁ¥†
    const currentTimeEl = document.getElementById('currentTime');
    const taskInput = document.getElementById('taskInput');
    const quickTasksEl = document.getElementById('quickTasks');
    const completeBtn = document.getElementById('completeBtn');
    const messageEl = document.getElementById('message');
    const todayCountEl = document.getElementById('todayCount');
    const totalCountEl = document.getElementById('totalCount');
    const timelineEl = document.getElementById('timeline');
    const logCountEl = document.getElementById('logCount');
    const apiKeyInput = document.getElementById('apiKey');
    const settingsToggle = document.getElementById('settingsToggle');
    const settingsSection = document.getElementById('settingsSection');
    const modal = document.getElementById('taskModal');
    const modalTitle = document.getElementById('modalTitle');
    const taskNameInput = document.getElementById('taskNameInput');
    const emojiPicker = document.getElementById('emojiPicker');
    const colorPicker = document.getElementById('colorPicker');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const deleteBtn = document.getElementById('deleteBtn');

    // ÁèæÂú®ÊôÇÂàª„ÇíÊõ¥Êñ∞
    function updateCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      currentTimeEl.textContent = `${hours}:${minutes}`;
    }

    // ‰ªäÊó•„ÅÆÊó•‰ªò„Ç≠„Éº
    function getTodayKey() {
      return new Date().toISOString().split('T')[0];
    }

    // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
    function loadData() {
      // „ÇØ„Ç§„ÉÉ„ÇØ„Çø„Çπ„ÇØ
      const savedTasks = localStorage.getItem('quickTasks');
      quickTasks = savedTasks ? JSON.parse(savedTasks) : [...DEFAULT_QUICK_TASKS];

      // ‰ªäÊó•„ÅÆ„É≠„Ç∞
      const today = getTodayKey();
      const savedDate = localStorage.getItem('lastDate');

      if (savedDate !== today) {
        todayLogs = [];
        localStorage.setItem('todayLogs', JSON.stringify([]));
        localStorage.setItem('lastDate', today);
      } else {
        todayLogs = JSON.parse(localStorage.getItem('todayLogs') || '[]');
      }

      // Áµ±Ë®à
      const totalCount = parseInt(localStorage.getItem('totalCount')) || 0;
      todayCountEl.textContent = todayLogs.length;
      totalCountEl.textContent = totalCount;

      // API„Ç≠„ÉºÂæ©ÂÖÉ
      const savedKey = localStorage.getItem('geminiApiKey');
      if (savedKey) apiKeyInput.value = savedKey;

      renderQuickTasks();
      renderTimeline();
    }

    // „ÇØ„Ç§„ÉÉ„ÇØ„Çø„Çπ„ÇØ„ÇíÊèèÁîª
    function renderQuickTasks() {
      quickTasksEl.innerHTML = '';

      quickTasks.forEach(task => {
        const btn = document.createElement('button');
        btn.className = `quick-task-btn color-${task.color}`;
        btn.innerHTML = `<span class="emoji">${task.emoji}</span><span class="label">${task.label}</span>`;
        btn.addEventListener('click', () => {
          taskInput.value = `${task.emoji} ${task.label}„Åó„Åü`;
          taskInput.focus();
        });
        btn.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          openEditModal(task.id);
        });
        // Èï∑Êäº„ÅóÂØæÂøú
        let pressTimer;
        btn.addEventListener('touchstart', () => {
          pressTimer = setTimeout(() => openEditModal(task.id), 500);
        });
        btn.addEventListener('touchend', () => clearTimeout(pressTimer));
        btn.addEventListener('touchmove', () => clearTimeout(pressTimer));

        quickTasksEl.appendChild(btn);
      });

      // ËøΩÂä†„Éú„Çø„É≥
      const addBtn = document.createElement('button');
      addBtn.className = 'add-task-btn';
      addBtn.innerHTML = '<span>‚ûï</span><span>ËøΩÂä†</span>';
      addBtn.addEventListener('click', openAddModal);
      quickTasksEl.appendChild(addBtn);
    }

    // „Çø„Ç§„É†„É©„Ç§„É≥ÊèèÁîª
    function renderTimeline() {
      logCountEl.textContent = `${todayLogs.length}‰ª∂`;

      if (todayLogs.length === 0) {
        timelineEl.innerHTML = '<div class="timeline-empty">„Åæ„Å†„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>„Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Åó„Å¶Ë®òÈå≤„Åó„Çà„ÅÜÔºÅ</div>';
        return;
      }

      const sortedLogs = [...todayLogs].reverse();
      timelineEl.innerHTML = sortedLogs.map(log => `
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-time">${log.time}</div>
          <div class="timeline-task">${log.task}</div>
          <div class="timeline-praise">${log.praise}</div>
        </div>
      `).join('');
    }

    // „É≠„Ç∞„ÇíËøΩÂä†
    function addLog(task, praise) {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');

      const log = { time: `${hours}:${minutes}`, task, praise };

      todayLogs.push(log);
      localStorage.setItem('todayLogs', JSON.stringify(todayLogs));
      localStorage.setItem('lastDate', getTodayKey());

      const totalCount = parseInt(localStorage.getItem('totalCount') || '0') + 1;
      localStorage.setItem('totalCount', totalCount.toString());

      todayCountEl.textContent = todayLogs.length;
      totalCountEl.textContent = totalCount;

      renderTimeline();
    }

    // Á¥ôÂêπÈõ™
    function createConfetti() {
      const colors = ['#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#2ecc71'];
      for (let i = 0; i < 20; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = Math.random() * 200 + 'px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 1000);
        }, i * 30);
      }
    }

    // „Éó„É™„Çª„ÉÉ„ÉàË§í„ÇÅË®ÄËëâÔºàAPI„Ç≠„Éº„Å™„Åó„Åß„ÇÇ‰Ωø„Åà„ÇãÔºâ
    const PRESET_PRAISES = [
      '‰∫∫È°û„ÅÆÂ∏åÊúõÔºÅÔºÅ„ÅÇ„Å™„Åü„ÅÆÂä™Âäõ„Åå‰∏ñÁïå„ÇíÂ§â„Åà„ÇãÔºÅÔºÅüî•üî•‚ú®',
      'Â§©Êâç„Åô„Åé„Å¶ÂÆáÂÆô„Åå„Éì„Éì„Å£„Å¶„ÇãÔºÅÔºÅüåå‚ú®üí´',
      '„Åì„ÅÆË™øÂ≠ê„Å†„Å®ÊòéÊó•„Å´„ÅØ‰∏ñÁïåÂæÅÊúç„Åß„Åç„ÇãÔºÅÔºÅüëëüî•üî•',
      '‰ºùË™¨„ÅØ„Åì„ÅÜ„Åó„Å¶‰Ωú„Çâ„Çå„ÇãÔºÅÔºÅÊ≠¥Âè≤„Å´Âàª„Åæ„Çå„ÇãÁû¨ÈñìÔºÅÔºÅüìú‚ú®üî•',
      '„ÅÇ„Å™„Åü„ÅÆË°åÂãïÂäõ„ÄÅÂõΩÂÆùÊåáÂÆöÂæÖ„Å£„Åü„Å™„ÅóÔºÅÔºÅüèÜüí™‚ú®',
      'Á•ûÈôçËá®ÔºÅÔºÅ„Ç™„É™„É≥„Éù„Çπ„Åã„ÇâÊãçÊâã„ÅåËÅû„Åì„Åà„ÇãÔºÅÔºÅ‚ö°üëèüî•',
      '„Åô„Åî„Åô„Åé„Å¶Ë®ÄËëâ„ÅåËøΩ„ÅÑ„Å§„Åã„Å™„ÅÑÔºÅÔºÅÊúÄÈ´òofÊúÄÈ´òÔºÅÔºÅüéâüéâ‚ú®',
      'Âä™Âäõ„ÅÆÁµêÊô∂ÔºÅÔºÅÊú™Êù•„ÅÆ„ÅÇ„Å™„Åü„ÅåÊ≥£„ÅÑ„Å¶ÊÑüË¨ù„Åó„Å¶„ÇãÔºÅÔºÅüò≠üíé‚ú®',
      '„ÇÇ„ÅØ„ÇÑ‰∫∫Èñì„ÅÆÂüü„ÇíË∂Ö„Åà„ÅüÔºÅÔºÅÂúßÂÄíÁöÑÊàêÈï∑ÔºÅÔºÅüöÄüî•üí™',
      '‰ªäÊó•„ÅÆMVPÁ¢∫ÂÆöÔºÅÔºÅ„Çπ„Çø„É≥„Éá„Ç£„É≥„Ç∞„Ç™„Éô„Éº„Ç∑„Éß„É≥ÔºÅÔºÅüëèüëèüèÜ',
      '„ÇÑ„Å∞„ÅÑÔºÅÔºÅ„Åã„Å£„Åì„Çà„Åô„Åé„Å¶ÊÉö„Çå„Åù„ÅÜÔºÅÔºÅüíïüî•‚ú®',
      'ÂÅâÊ•≠ÈÅîÊàêÔºÅÔºÅÊïôÁßëÊõ∏„Å´Ëºâ„Çã„É¨„Éô„É´ÔºÅÔºÅüìöüèÖüî•',
      '„Åù„ÅÆÊÑèÂøó„ÅÆÂº∑„Åï„ÄÅ„ÉÄ„Ç§„É§„É¢„É≥„Éâ„Çà„ÇäÁ°¨„ÅÑÔºÅÔºÅüíéüí™‚ú®',
      'Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÔºÅ„ÅÇ„Å™„Åü„ÅØÈÅ∏„Å∞„Çå„ÅóËÄÖÔºÅÔºÅüëë‚ú®üî•',
      'ÂÆåÁíßÔºÅÔºÅ100ÁÇπÊ∫ÄÁÇπ‰∏≠1ÂÑÑÁÇπÔºÅÔºÅüíØüî•üéâ',
      '„Éó„É≠ÊÑèË≠ò„Åå„Åô„Åî„Åô„Åé„ÇãÔºÅÔºÅÂ∞äÊï¨„Åó„Åã„Å™„ÅÑÔºÅÔºÅüôá‚Äç‚ôÇÔ∏è‚ú®üí™',
      '„ÇÑ„Çä„Åç„Å£„ÅüÔºÅÔºÅ„Åì„ÅÆÈÅîÊàêÊÑü„ÄÅ„Éó„É©„Ç§„Çπ„É¨„ÇπÔºÅÔºÅüí∞üî•‚ú®',
      'Á∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅÔºÅ„ÅÇ„Å™„Åü„ÅåË®ºÊòé„Åó„ÅüÔºÅÔºÅüìàüí™üî•',
      '„Å©„Åì„Åæ„ÅßÈÄ≤Âåñ„Åô„Çã„ÅÆÔºÅÔºüÈôêÁïåÁ™ÅÁ†¥ÔºÅÔºÅüöÄüî•‚ú®',
      '‰ªäÊó•„ÇÇÊúÄÈ´ò„ÅÆ1Êó•„Å´„Åó„ÅüÔºÅÔºÅÂ§©Êâç„Åã„Å™ÔºÅÔºüüåüüéâüí™',
      '„Åù„ÅÆË°åÂãïÂäõ„ÄÅË¶ãÁøí„ÅÑ„Åü„ÅÑÔºÅÔºÅ„É™„Çπ„Éö„ÇØ„ÉàÔºÅÔºÅüôå‚ú®üî•',
      '„Ç≥„ÉÑ„Ç≥„ÉÑ„ÅÆÁ©ç„ÅøÈáç„Å≠ÔºÅÔºÅ„Åì„Çå„ÅåÊú¨Áâ©„ÅÆÂº∑„ÅïÔºÅÔºÅüíéüí™üî•',
      'Á¥†Êïµ„Åô„Åé„ÇãÔºÅÔºÅ‰∏ñÁïå„Åå„ÅÇ„Å™„Åü„ÇíÂæÖ„Å£„Å¶„ÅÑ„ÅüÔºÅÔºÅüåç‚ú®üíï',
      '„Éñ„É©„Éú„ÉºÔºÅÔºÅ„Çπ„Çø„É≥„Éá„Ç£„É≥„Ç∞„Ç™„Éô„Éº„Ç∑„Éß„É≥3ÊôÇÈñìÔºÅÔºÅüëèüëèüéâ',
      'ÂúßÂ∑ª„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÔºÅÔºÅÈáë„É°„ÉÄ„É´Á¥öÔºÅÔºÅü•áüî•‚ú®',
      'Ëá™ÂàÜ„Å´Âãù„Å£„ÅüÔºÅÔºÅ„Åì„Çå„Åì„ÅùÊú¨ÂΩì„ÅÆÂãùÂà©ÔºÅÔºÅüèÜüí™üî•',
      'ÊØéÊó•„ÅÆÂä™Âäõ„ÅåËä±Èñã„ÅèÁû¨ÈñìÔºÅÔºÅÁæé„Åó„Åô„Åé„ÇãÔºÅÔºÅüå∏‚ú®üíé',
      '„ÅÇ„Å™„Åü„Åå„ÅÑ„Çã„Åã„Çâ‰∏ñÁïå„ÅØÂõû„ÇãÔºÅÔºÅÊÑüË¨ùÔºÅÔºÅüåèüíï‚ú®',
      'ÊúÄÂº∑ÔºÅÔºÅÁÑ°ÊïµÔºÅÔºÅ„ÉÅ„É£„É≥„Éî„Ç™„É≥ÔºÅÔºÅüèÜüëëüî•',
      '‰ªäÊó•„Å®„ÅÑ„ÅÜÊó•„ÇíÂà∂Ë¶á„Åó„ÅüÔºÅÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅÔºÅüéäüéâ‚ú®',
      'Áú©„Åó„Åô„Åé„Å¶Áõ¥Ë¶ñ„Åß„Åç„Å™„ÅÑÊ¥ªË∫çÔºÅÔºÅ‚òÄÔ∏è‚ú®üí™',
      '„É¨„Ç∏„Çß„É≥„ÉâÁàÜË™ï„ÅÆ‰∫àÊÑüÔºÅÔºÅÊ≠¥Âè≤„ÅåÂãï„ÅÑ„ÅüÔºÅÔºÅüìúüî•üéâ',
      '‰∏ÄÊ≠©‰∏ÄÊ≠©„ÅåÂÅâÂ§ßÔºÅÔºÅ„Éû„Ç∏„Åß„É™„Çπ„Éö„ÇØ„ÉàÔºÅÔºÅüôåüí™‚ú®',
      '„Åì„ÅÆË™øÂ≠ê„ÅßÂÆáÂÆôÂæÅÊúç„ÇÇÂ§¢„Åò„ÇÉ„Å™„ÅÑÔºÅÔºÅüöÄüååüëë',
      '„ÅÇ„Å™„Åü„ÅÆÂä™Âäõ„Å´‰πæÊùØÔºÅÔºÅÊúÄÈ´òÔºÅÔºÅü•Ç‚ú®üî•',
      'ÊúâË®ÄÂÆüË°åÔºÅÔºÅ„Åã„Å£„Åì„Çà„Åô„ÅéÂïèÈ°åÔºÅÔºÅüòéüí™üî•',
      'Ëá™ÂàÜÂè≤‰∏äÊúÄÈ´ò„ÇíÊõ¥Êñ∞‰∏≠ÔºÅÔºÅ„Å©„Åì„Åæ„Åß„ÅÑ„Åè„ÅÆÔºÅÔºüüìàüî•‚ú®',
      '„Éí„Éº„É≠„ÉºÈôçËá®ÔºÅÔºÅË°ó„ÇíÊïë„Å£„ÅüÊÑü„ÅÇ„ÇãÔºÅÔºÅü¶∏‚Äç‚ôÇÔ∏è‚ú®üí™',
      'Â∞ä„ÅÑ...ÔºÅÔºÅ„ÅÇ„Å™„Åü„ÅÆÈ†ëÂºµ„Çä„ÅåÂ∞ä„Åô„Åé„ÇãÔºÅÔºÅüôèüíé‚ú®',
      '„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅÔºÅÈùû„ÅÆÊâì„Å°ÊâÄ„Åå„Å™„ÅÑÔºÅÔºÅüíØüëëüî•',
    ];

    // Ë§í„ÇÅË®ÄËëâÂèñÂæó
    async function getPraise(task) {
      const apiKey = apiKeyInput.value.trim();

      // API„Ç≠„Éº„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Éó„É™„Çª„ÉÉ„Éà„Åã„Çâ„É©„É≥„ÉÄ„É†ÈÅ∏Êäû
      if (!apiKey) {
        return PRESET_PRAISES[Math.floor(Math.random() * PRESET_PRAISES.length)];
      }

      localStorage.setItem('geminiApiKey', apiKey);

      const prompt = `„ÅÇ„Å™„Åü„ÅØ‰∏ñÁïå‰∏Ä„Ç™„Éº„Éê„Éº„Å´Ë§í„ÇÅ„ÇãBOT„Åß„Åô„ÄÇË™¨Êòé„ÇÑÂâçÁΩÆ„Åç„ÅØ‰∏ÄÂàá‰∏çË¶Å„ÄÇË§í„ÇÅË®ÄËëâ„Å†„Åë„Çí1„Å§Ëøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

Êù°‰ª∂Ôºö
- „Äå${task}„Äç„ÇíÂÆå‰∫Ü„Åó„Åü‰∫∫„ÇíÂ§ß„Åí„Åï„Å´Ë§í„ÇÅ„Çã
- „Åæ„Çã„Åß‰∏ñÁïå„ÇíÊïë„Å£„Åü„Åã„ÅÆ„Çà„ÅÜ„Å´ÁÜ±ÁãÇÁöÑ„Å´Áß∞„Åà„Çã
- 50ÊñáÂ≠ó‰ª•ÂÜÖ
- ÁµµÊñáÂ≠ó„Çí2„Äú3ÂÄã‰Ωø„ÅÜ
- „ÄåÔºÅ„Äç„ÇíÂ§öÁî®„Åó„Å¶„ÉÜ„É≥„Ç∑„Éß„É≥È´ò„Åè
- Ë§í„ÇÅË®ÄËëâ„ÅÆ„ÅøÂá∫Âäõ

ÊÇ™„ÅÑ‰æãÔºö„Äå„Åà„Çâ„ÅÑÔºÅÂ§©ÊâçÔºÅ„ÄçÔºà‚Üê „Ç∑„É≥„Éó„É´„Åô„ÅéÔºâ
ËâØ„ÅÑ‰æãÔºö„Äå‰∫∫È°û„ÅÆÂ∏åÊúõÔºÅÔºÅ„ÅÇ„Å™„Åü„ÅÆÂä™Âäõ„Åå‰∏ñÁïå„ÇíÂ§â„Åà„ÇãÔºÅÔºÅüî•üî•‚ú®„Äç`;

      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
          }
        );

        if (!response.ok) throw new Error('API error');
        const data = await response.json();
        return data.candidates[0].content.parts[0].text.trim();
      } catch (error) {
        console.error(error);
        // API„Ç®„É©„ÉºÊôÇ„ÇÇ„Éó„É™„Çª„ÉÉ„Éà„Çí‰ΩøÁî®
        return PRESET_PRAISES[Math.floor(Math.random() * PRESET_PRAISES.length)];
      }
    }

    // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    function showMessage(text) {
      messageEl.classList.remove('show');
      setTimeout(() => {
        messageEl.textContent = text;
        messageEl.classList.add('show');
      }, 100);
    }

    // ÂÆå‰∫Ü„Éú„Çø„É≥
    completeBtn.addEventListener('click', async () => {
      const task = taskInput.value.trim();
      if (!task) {
        showMessage('„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Å≠ÔºÅüìù');
        return;
      }

      completeBtn.disabled = true;
      completeBtn.textContent = 'üîÑ';

      createConfetti();
      const praise = await getPraise(task);

      addLog(task, praise);
      showMessage(praise);

      taskInput.value = '';
      completeBtn.disabled = false;
      completeBtn.textContent = 'ÂÆå‰∫ÜÔºÅüí™';
    });

    // Enter„Ç≠„Éº„ÅßÂÆå‰∫Ü
    taskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') completeBtn.click();
    });

    // Ë®≠ÂÆö„Éà„Ç∞„É´
    settingsToggle.addEventListener('click', () => {
      settingsSection.classList.toggle('show');
    });

    // ===== „É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£ =====

    // „Éî„ÉÉ„Ç´„ÉºÂàùÊúüÂåñ
    function initPickers() {
      emojiPicker.innerHTML = '';
      EMOJIS.forEach(emoji => {
        const btn = document.createElement('button');
        btn.className = 'emoji-option';
        btn.textContent = emoji;
        btn.type = 'button';
        btn.addEventListener('click', () => {
          selectedEmoji = emoji;
          updatePickerSelection();
        });
        emojiPicker.appendChild(btn);
      });

      colorPicker.innerHTML = '';
      COLORS.forEach(color => {
        const btn = document.createElement('button');
        btn.className = `color-option color-${color}`;
        btn.dataset.color = color;
        btn.type = 'button';
        btn.addEventListener('click', () => {
          selectedColor = color;
          updatePickerSelection();
        });
        colorPicker.appendChild(btn);
      });
    }

    function updatePickerSelection() {
      document.querySelectorAll('.emoji-option').forEach(btn => {
        btn.classList.toggle('selected', btn.textContent === selectedEmoji);
      });
      document.querySelectorAll('.color-option').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.color === selectedColor);
      });
    }

    function openAddModal() {
      editingTaskId = null;
      modalTitle.textContent = '„Çø„Çπ„ÇØ„ÇíËøΩÂä†';
      taskNameInput.value = '';
      selectedEmoji = 'üí™';
      selectedColor = 'red';
      deleteBtn.style.display = 'none';
      updatePickerSelection();
      modal.classList.add('show');
    }

    function openEditModal(taskId) {
      const task = quickTasks.find(t => t.id === taskId);
      if (!task) return;

      editingTaskId = taskId;
      modalTitle.textContent = '„Çø„Çπ„ÇØ„ÇíÁ∑®ÈõÜ';
      taskNameInput.value = task.label;
      selectedEmoji = task.emoji;
      selectedColor = task.color;
      deleteBtn.style.display = 'block';
      updatePickerSelection();
      modal.classList.add('show');
    }

    function closeModal() {
      modal.classList.remove('show');
    }

    function saveTask() {
      const label = taskNameInput.value.trim();
      if (!label) {
        alert('„Çø„Çπ„ÇØÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
      }

      if (editingTaskId) {
        const task = quickTasks.find(t => t.id === editingTaskId);
        if (task) {
          task.label = label;
          task.emoji = selectedEmoji;
          task.color = selectedColor;
        }
      } else {
        quickTasks.push({
          id: 'task_' + Date.now(),
          emoji: selectedEmoji,
          label: label,
          color: selectedColor
        });
      }

      localStorage.setItem('quickTasks', JSON.stringify(quickTasks));
      renderQuickTasks();
      closeModal();
    }

    function deleteTask() {
      if (!editingTaskId) return;
      if (!confirm('„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

      quickTasks = quickTasks.filter(t => t.id !== editingTaskId);
      localStorage.setItem('quickTasks', JSON.stringify(quickTasks));
      renderQuickTasks();
      closeModal();
    }

    saveBtn.addEventListener('click', saveTask);
    cancelBtn.addEventListener('click', closeModal);
    deleteBtn.addEventListener('click', deleteTask);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    // Service WorkerÁôªÈå≤
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registered'))
        .catch(err => console.log('SW registration failed:', err));
    }

    // ÂàùÊúüÂåñ
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    initPickers();
    loadData();
  </script>
</body>

</html>