<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ë§í„ÇÅÊÆ∫„Åó„É≠„Ç¨„Éº</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            padding: 20px;
            padding-bottom: 100px;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 4px;
        }

        /* „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ */
        .task-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
            margin-bottom: 24px;
        }

        .task-btn {
            padding: 18px 12px;
            border-radius: 18px;
            border: none;
            color: #fff;
            font-family: 'Noto Sans JP', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            text-align: center;
        }

        .task-btn:hover {
            transform: translateY(-3px);
        }

        .task-btn:active {
            transform: scale(0.96);
        }

        .task-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .task-btn .emoji {
            font-size: 2.2rem;
            display: block;
            margin-bottom: 6px;
        }

        .task-btn .label {
            font-size: 0.9rem;
            font-weight: 700;
        }

        .task-btn .count {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.3);
            padding: 3px 9px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .task-btn .edit-icon {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(255, 255, 255, 0.2);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .task-btn:hover .edit-icon {
            opacity: 1;
        }

        /* ËøΩÂä†„Éú„Çø„É≥ */
        .add-btn {
            padding: 18px 12px;
            border-radius: 18px;
            border: 3px dashed rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.6);
            font-family: 'Noto Sans JP', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .add-btn:hover {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .add-btn .emoji {
            font-size: 2rem;
            display: block;
            margin-bottom: 6px;
        }

        .add-btn .label {
            font-size: 0.85rem;
        }

        /* Ëâ≤„Éó„É™„Çª„ÉÉ„Éà */
        .color-red {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            box-shadow: 0 6px 24px rgba(231, 76, 60, 0.4);
        }

        .color-blue {
            background: linear-gradient(145deg, #3498db, #2980b9);
            box-shadow: 0 6px 24px rgba(52, 152, 219, 0.4);
        }

        .color-green {
            background: linear-gradient(145deg, #2ecc71, #27ae60);
            box-shadow: 0 6px 24px rgba(46, 204, 113, 0.4);
        }

        .color-purple {
            background: linear-gradient(145deg, #9b59b6, #8e44ad);
            box-shadow: 0 6px 24px rgba(155, 89, 182, 0.4);
        }

        .color-orange {
            background: linear-gradient(145deg, #e67e22, #d35400);
            box-shadow: 0 6px 24px rgba(230, 126, 34, 0.4);
        }

        .color-pink {
            background: linear-gradient(145deg, #fd79a8, #e84393);
            box-shadow: 0 6px 24px rgba(232, 67, 147, 0.4);
        }

        .color-teal {
            background: linear-gradient(145deg, #00cec9, #00b894);
            box-shadow: 0 6px 24px rgba(0, 206, 201, 0.4);
        }

        .color-yellow {
            background: linear-gradient(145deg, #fdcb6e, #f39c12);
            box-shadow: 0 6px 24px rgba(253, 203, 110, 0.4);
        }

        /* „É°„ÉÉ„Çª„Éº„Ç∏ */
        .message-box {
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .message {
            font-size: 1.1rem;
            font-weight: 700;
            line-height: 1.6;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            text-align: center;
        }

        .message.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* ‰ªäÊó•„ÅÆ„Çµ„Éû„É™„Éº */
        .summary {
            background: rgba(255, 255, 255, 0.08);
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .summary-title {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .summary-items {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 1rem;
        }

        /* Áµ±Ë®à */
        .stats {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            border-radius: 12px;
            text-align: center;
            flex: 1;
        }

        .stat-number {
            font-size: 1.6rem;
            font-weight: 900;
            color: #f39c12;
        }

        .stat-label {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 2px;
        }

        /* API Key */
        .api-key-section {
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .api-key-section input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            color: #fff;
            font-size: 0.85rem;
            margin-top: 6px;
        }

        .api-key-section input:focus {
            outline: none;
            border-color: #f39c12;
        }

        .api-key-section label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* „É¢„Éº„ÉÄ„É´ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: linear-gradient(145deg, #1e2a4a, #162035);
            border-radius: 20px;
            padding: 24px;
            width: 100%;
            max-width: 360px;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: translateY(0);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-field {
            margin-bottom: 16px;
        }

        .modal-field label {
            display: block;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 6px;
        }

        .modal-field input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1rem;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .modal-field input:focus {
            outline: none;
            border-color: #f39c12;
        }

        /* ÁµµÊñáÂ≠ó„Éî„ÉÉ„Ç´„Éº */
        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .emoji-option {
            width: 100%;
            aspect-ratio: 1;
            border: 2px solid transparent;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .emoji-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .emoji-option.selected {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.2);
        }

        /* Ëâ≤„Éî„ÉÉ„Ç´„Éº */
        .color-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #fff;
        }

        /* „É¢„Éº„ÉÄ„É´„Éú„Çø„É≥ */
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'Noto Sans JP', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.primary {
            background: linear-gradient(145deg, #f39c12, #e67e22);
            color: #fff;
        }

        .modal-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .modal-btn.danger {
            background: rgba(231, 76, 60, 0.8);
            color: #fff;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* Á¥ôÂêπÈõ™ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            animation: confetti-fall 1s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }

            100% {
                opacity: 0;
                transform: translateY(300px) rotate(720deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üéâ Ë§í„ÇÅÊÆ∫„Åó„É≠„Ç¨„Éº</h1>
            <p class="subtitle">„Çø„Çπ„ÇØ„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë§í„ÇÅ„Çâ„Çå„Çà„ÅÜÔºÅ</p>
        </div>

        <div class="task-grid" id="taskGrid">
            <!-- „Çø„Çπ„ÇØ„Éú„Çø„É≥„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
        </div>

        <div class="message-box">
            <p class="message" id="message"></p>
        </div>

        <div class="summary">
            <div class="summary-title">üìÖ ‰ªäÊó•„ÅÆÈÅîÊàê</div>
            <div class="summary-items" id="summaryItems">„Åæ„Å†„Çø„Çπ„ÇØ„Å™„Åó</div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="todayTotal">0</div>
                <div class="stat-label">‰ªäÊó•„ÅÆÂêàË®à</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Á¥ØË®à</div>
            </div>
        </div>

        <div class="api-key-section">
            <label for="apiKey">üîë Gemini API Key</label>
            <input type="password" id="apiKey" placeholder="AIza...">
        </div>
    </div>

    <!-- „Çø„Çπ„ÇØÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <h2 class="modal-title" id="modalTitle">„Çø„Çπ„ÇØ„ÇíËøΩÂä†</h2>

            <div class="modal-field">
                <label>„Çø„Çπ„ÇØÂêç</label>
                <input type="text" id="taskName" placeholder="‰æãÔºöÁ≠ã„Éà„É¨„Åó„Åü">
            </div>

            <div class="modal-field">
                <label>„Ç¢„Ç§„Ç≥„É≥</label>
                <div class="emoji-picker" id="emojiPicker"></div>
            </div>

            <div class="modal-field">
                <label>Ëâ≤</label>
                <div class="color-picker" id="colorPicker"></div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelBtn">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="modal-btn danger" id="deleteBtn" style="display: none;">ÂâäÈô§</button>
                <button class="modal-btn primary" id="saveBtn">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script>
        // ÁµµÊñáÂ≠ó„É™„Çπ„Éà
        const EMOJIS = ['üí™', 'üìö', 'üíä', 'üíß', 'üèÉ', 'üßò', '‚úçÔ∏è', 'üéß', 'üåø', 'üßπ', 'üò¥', 'üçé',
            '‚òï', 'üéØ', 'üî•', '‚≠ê', 'üíé', 'üåô', 'üéµ', 'üíª', 'üìù', 'üé®', 'üö¥', 'üèãÔ∏è'];

        // Ëâ≤„É™„Çπ„Éà
        const COLORS = ['red', 'blue', 'green', 'purple', 'orange', 'pink', 'teal', 'yellow'];

        // „Éá„Éï„Ç©„É´„Éà„Çø„Çπ„ÇØ
        const DEFAULT_TASKS = [
            { id: 'workout', emoji: 'üí™', label: 'Á≠ã„Éà„É¨„Åó„Åü', color: 'red' },
            { id: 'study', emoji: 'üìö', label: 'ÂãâÂº∑„Åó„Åü', color: 'blue' },
            { id: 'medicine', emoji: 'üíä', label: 'Ëñ¨„ÇíÈ£≤„Çì„Å†', color: 'green' },
            { id: 'water', emoji: 'üíß', label: 'Ê∞¥„ÇíÈ£≤„Çì„Å†', color: 'purple' },
        ];

        // Áä∂ÊÖã
        let tasks = [];
        let editingTaskId = null;
        let selectedEmoji = 'üí™';
        let selectedColor = 'red';

        // DOMË¶ÅÁ¥†
        const taskGrid = document.getElementById('taskGrid');
        const messageEl = document.getElementById('message');
        const todayTotalEl = document.getElementById('todayTotal');
        const totalCountEl = document.getElementById('totalCount');
        const summaryItemsEl = document.getElementById('summaryItems');
        const apiKeyInput = document.getElementById('apiKey');
        const modal = document.getElementById('taskModal');
        const modalTitle = document.getElementById('modalTitle');
        const taskNameInput = document.getElementById('taskName');
        const emojiPicker = document.getElementById('emojiPicker');
        const colorPicker = document.getElementById('colorPicker');
        const saveBtn = document.getElementById('saveBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const deleteBtn = document.getElementById('deleteBtn');

        // ‰ªäÊó•„ÅÆÊó•‰ªò„Ç≠„Éº
        function getTodayKey() {
            return new Date().toISOString().split('T')[0];
        }

        // „Çø„Çπ„ÇØ„ÇíË™≠„ÅøËæº„Åø
        function loadTasks() {
            const saved = localStorage.getItem('customTasks');
            if (saved) {
                tasks = JSON.parse(saved);
            } else {
                tasks = [...DEFAULT_TASKS];
                saveTasks();
            }
        }

        // „Çø„Çπ„ÇØ„Çí‰øùÂ≠ò
        function saveTasks() {
            localStorage.setItem('customTasks', JSON.stringify(tasks));
        }

        // „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÇíÊèèÁîª
        function renderTasks() {
            taskGrid.innerHTML = '';

            const today = getTodayKey();
            const savedDate = localStorage.getItem('lastDate');

            // Êó•‰ªò„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åü„Çâ„É™„Çª„ÉÉ„Éà
            if (savedDate !== today) {
                tasks.forEach(task => {
                    localStorage.setItem(`today_${task.id}`, '0');
                });
                localStorage.setItem('lastDate', today);
            }

            tasks.forEach(task => {
                const count = parseInt(localStorage.getItem(`today_${task.id}`)) || 0;
                const btn = document.createElement('button');
                btn.className = `task-btn color-${task.color}`;
                btn.dataset.taskId = task.id;
                btn.innerHTML = `
          <span class="edit-icon" data-edit="${task.id}">‚úèÔ∏è</span>
          <span class="count">${count}</span>
          <span class="emoji">${task.emoji}</span>
          <span class="label">${task.label}</span>
        `;

                btn.addEventListener('click', (e) => {
                    if (e.target.dataset.edit) {
                        openEditModal(task.id);
                    } else {
                        completeTask(task.id);
                    }
                });

                taskGrid.appendChild(btn);
            });

            // ËøΩÂä†„Éú„Çø„É≥
            const addBtn = document.createElement('button');
            addBtn.className = 'add-btn';
            addBtn.innerHTML = `
        <span class="emoji">‚ûï</span>
        <span class="label">ËøΩÂä†</span>
      `;
            addBtn.addEventListener('click', openAddModal);
            taskGrid.appendChild(addBtn);

            updateSummary();
        }

        // „Çµ„Éû„É™„ÉºÊõ¥Êñ∞
        function updateSummary() {
            let todayTotal = 0;
            const items = [];

            tasks.forEach(task => {
                const count = parseInt(localStorage.getItem(`today_${task.id}`)) || 0;
                if (count > 0) {
                    items.push(`${task.emoji}√ó${count}`);
                    todayTotal += count;
                }
            });

            todayTotalEl.textContent = todayTotal;
            const total = parseInt(localStorage.getItem('totalCount')) || 0;
            totalCountEl.textContent = total;

            summaryItemsEl.innerHTML = items.length > 0
                ? items.map(item => `<span>${item}</span>`).join(' ')
                : '„Åæ„Å†„Çø„Çπ„ÇØ„Å™„Åó';
        }

        // „Çø„Çπ„ÇØÂÆå‰∫Ü
        async function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const btn = document.querySelector(`[data-task-id="${taskId}"]`);
            btn.classList.add('loading');

            // „Ç´„Ç¶„É≥„ÉàÂ¢óÂä†
            const todayCount = parseInt(localStorage.getItem(`today_${taskId}`) || '0') + 1;
            const totalCount = parseInt(localStorage.getItem('totalCount') || '0') + 1;
            localStorage.setItem(`today_${taskId}`, todayCount.toString());
            localStorage.setItem('totalCount', totalCount.toString());
            localStorage.setItem('lastDate', getTodayKey());

            // Á¥ôÂêπÈõ™
            createConfetti();

            // Ë§í„ÇÅË®ÄËëâÂèñÂæó
            const praise = await getPraise(task);
            showMessage(praise);

            // UIÊõ¥Êñ∞
            renderTasks();
            btn.classList.remove('loading');
        }

        // Á¥ôÂêπÈõ™
        function createConfetti() {
            const colors = ['#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#2ecc71'];
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.top = Math.random() * 200 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 1000);
                }, i * 30);
            }
        }

        // Ë§í„ÇÅË®ÄËëâÂèñÂæó
        async function getPraise(task) {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) return '„Åæ„ÅöAPI„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Å≠ÔºÅüîë';

            localStorage.setItem('geminiApiKey', apiKey);

            const prompt = `„Äå${task.label}„Äç„Å®„ÅÑ„ÅÜ„Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Åó„Åü‰∫∫„Çí„ÄÅ„É¶„Éã„Éº„ÇØ„ÅßÈù¢ÁôΩ„ÅÑË®ÄËëâ„ÅßÁü≠„ÅèË§í„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑÔºà30ÊñáÂ≠ó‰ª•ÂÜÖ„ÄÅÁµµÊñáÂ≠ó‰ªò„ÅçÔºâ`;

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    }
                );

                if (!response.ok) throw new Error('API error');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text.trim();
            } catch (error) {
                console.error(error);
                return '„Åô„Åî„ÅÑÔºÅ„Çø„Çπ„ÇØÂÆå‰∫Ü„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅüéâ';
            }
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showMessage(text) {
            messageEl.classList.remove('show');
            setTimeout(() => {
                messageEl.textContent = text;
                messageEl.classList.add('show');
            }, 100);
        }

        // ÁµµÊñáÂ≠ó„Éî„ÉÉ„Ç´„ÉºÂàùÊúüÂåñ
        function initPickers() {
            emojiPicker.innerHTML = '';
            EMOJIS.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'emoji-option';
                btn.textContent = emoji;
                btn.addEventListener('click', () => {
                    selectedEmoji = emoji;
                    updatePickerSelection();
                });
                emojiPicker.appendChild(btn);
            });

            colorPicker.innerHTML = '';
            COLORS.forEach(color => {
                const btn = document.createElement('button');
                btn.className = `color-option color-${color}`;
                btn.dataset.color = color;
                btn.addEventListener('click', () => {
                    selectedColor = color;
                    updatePickerSelection();
                });
                colorPicker.appendChild(btn);
            });
        }

        // „Éî„ÉÉ„Ç´„ÉºÈÅ∏ÊäûÁä∂ÊÖãÊõ¥Êñ∞
        function updatePickerSelection() {
            document.querySelectorAll('.emoji-option').forEach(btn => {
                btn.classList.toggle('selected', btn.textContent === selectedEmoji);
            });
            document.querySelectorAll('.color-option').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.color === selectedColor);
            });
        }

        // ËøΩÂä†„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openAddModal() {
            editingTaskId = null;
            modalTitle.textContent = '„Çø„Çπ„ÇØ„ÇíËøΩÂä†';
            taskNameInput.value = '';
            selectedEmoji = 'üí™';
            selectedColor = 'red';
            deleteBtn.style.display = 'none';
            updatePickerSelection();
            modal.classList.add('show');
        }

        // Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openEditModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            editingTaskId = taskId;
            modalTitle.textContent = '„Çø„Çπ„ÇØ„ÇíÁ∑®ÈõÜ';
            taskNameInput.value = task.label;
            selectedEmoji = task.emoji;
            selectedColor = task.color;
            deleteBtn.style.display = 'block';
            updatePickerSelection();
            modal.classList.add('show');
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeModal() {
            modal.classList.remove('show');
        }

        // „Çø„Çπ„ÇØ„Çí‰øùÂ≠ò
        function saveTask() {
            const label = taskNameInput.value.trim();
            if (!label) {
                alert('„Çø„Çπ„ÇØÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (editingTaskId) {
                // Á∑®ÈõÜ
                const task = tasks.find(t => t.id === editingTaskId);
                if (task) {
                    task.label = label;
                    task.emoji = selectedEmoji;
                    task.color = selectedColor;
                }
            } else {
                // ËøΩÂä†
                const newId = 'task_' + Date.now();
                tasks.push({
                    id: newId,
                    emoji: selectedEmoji,
                    label: label,
                    color: selectedColor
                });
            }

            saveTasks();
            renderTasks();
            closeModal();
        }

        // „Çø„Çπ„ÇØ„ÇíÂâäÈô§
        function deleteTask() {
            if (!editingTaskId) return;
            if (!confirm('„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            tasks = tasks.filter(t => t.id !== editingTaskId);
            localStorage.removeItem(`today_${editingTaskId}`);

            saveTasks();
            renderTasks();
            closeModal();
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        saveBtn.addEventListener('click', saveTask);
        cancelBtn.addEventListener('click', closeModal);
        deleteBtn.addEventListener('click', deleteTask);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // ÂàùÊúüÂåñ
        function init() {
            loadTasks();
            initPickers();
            renderTasks();

            // API„Ç≠„ÉºÂæ©ÂÖÉ
            const savedKey = localStorage.getItem('geminiApiKey');
            if (savedKey) apiKeyInput.value = savedKey;

            // Á¥ØË®àÂæ©ÂÖÉ
            const total = parseInt(localStorage.getItem('totalCount')) || 0;
            totalCountEl.textContent = total;
        }

        init();
    </script>
</body>

</html>